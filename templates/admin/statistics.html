{% extends "admin/base.html" %} {% block title %}Statistics & Analytics{%
endblock %} {% block page_title %}Statistics & Analytics{% endblock %} {% block
content %}
<!-- KPI Section - Top -->
<div class="row g-4 mb-5">
    <!-- Primary KPIs -->
    <div class="col-xl-3 col-md-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <div
                            class="rounded-circle bg-primary bg-opacity-10 p-3"
                        >
                            <i class="bi bi-people-fill fs-3 text-primary"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="text-muted mb-1">Total Users</h6>
                        <h2 class="mb-0 fw-bold">{{ stats.total_users }}</h2>
                        <small class="text-success"
                            ><i class="bi bi-arrow-up"></i> {{
                            stats.users_last_30_days }} this month</small
                        >
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <div
                            class="rounded-circle bg-success bg-opacity-10 p-3"
                        >
                            <i
                                class="bi bi-file-text-fill fs-3 text-success"
                            ></i>
                        </div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="text-muted mb-1">Total Loans</h6>
                        <h2 class="mb-0 fw-bold">{{ stats.total_loans }}</h2>
                        <small class="text-success"
                            ><i class="bi bi-arrow-up"></i> {{
                            stats.loans_last_30_days }} this month</small
                        >
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <div class="rounded-circle bg-info bg-opacity-10 p-3">
                            <i class="bi bi-currency-dollar fs-3 text-info"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="text-muted mb-1">Total Amount</h6>
                        <h2 class="mb-0 fw-bold">
                            ${{ "%.0f"|format(stats.total_amount) }}
                        </h2>
                        <small class="text-muted">All time disbursed</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <div
                            class="rounded-circle bg-warning bg-opacity-10 p-3"
                        >
                            <i class="bi bi-graph-up fs-3 text-warning"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="text-muted mb-1">Approval Rate</h6>
                        <h2 class="mb-0 fw-bold">{{ stats.approval_rate }}%</h2>
                        <small class="text-muted">Success rate</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Secondary KPIs -->
<div class="row g-4 mb-5">
    <div class="col-md-3">
        <div class="card border-0 shadow-sm">
            <div class="card-body text-center py-4">
                <i class="bi bi-clock-history fs-1 text-warning mb-2"></i>
                <h3 class="mb-1">{{ stats.loans_by_status.pending }}</h3>
                <p class="text-muted mb-0">Pending Review</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card border-0 shadow-sm">
            <div class="card-body text-center py-4">
                <i class="bi bi-check-circle-fill fs-1 text-success mb-2"></i>
                <h3 class="mb-1">{{ stats.loans_by_status.approved }}</h3>
                <p class="text-muted mb-0">Approved</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card border-0 shadow-sm">
            <div class="card-body text-center py-4">
                <i class="bi bi-activity fs-1 text-primary mb-2"></i>
                <h3 class="mb-1">{{ stats.loans_by_status.active }}</h3>
                <p class="text-muted mb-0">Active</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card border-0 shadow-sm">
            <div class="card-body text-center py-4">
                <i class="bi bi-check-all fs-1 text-secondary mb-2"></i>
                <h3 class="mb-1">{{ stats.loans_by_status.completed }}</h3>
                <p class="text-muted mb-0">Completed</p>
            </div>
        </div>
    </div>
</div>

<!-- Minimalistic Charts Section -->
<div class="row g-4">
    <!-- Loan Status Distribution -->
    <div class="col-lg-6">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom">
                <h5 class="mb-0 fw-bold">
                    <i class="bi bi-pie-chart me-2 text-primary"></i>Loan Status
                    Distribution
                </h5>
            </div>
            <div class="card-body">
                {% if stats.total_loans > 0 %}
                <div class="mb-4">
                    <div
                        class="d-flex justify-content-between align-items-center mb-2"
                    >
                        <span class="text-muted">Pending</span>
                        <span class="fw-bold text-warning"
                            >{{ stats.loans_by_status.pending }}</span
                        >
                    </div>
                    <div class="progress" style="height: 8px">
                        {% set percentage = (stats.loans_by_status.pending /
                        stats.total_loans * 100) %}
                        <div
                            class="progress-bar bg-warning"
                            style="width: {{ percentage }}%"
                        ></div>
                    </div>
                </div>

                <div class="mb-4">
                    <div
                        class="d-flex justify-content-between align-items-center mb-2"
                    >
                        <span class="text-muted">Approved</span>
                        <span class="fw-bold text-success"
                            >{{ stats.loans_by_status.approved }}</span
                        >
                    </div>
                    <div class="progress" style="height: 8px">
                        {% set percentage = (stats.loans_by_status.approved /
                        stats.total_loans * 100) %}
                        <div
                            class="progress-bar bg-success"
                            style="width: {{ percentage }}%"
                        ></div>
                    </div>
                </div>

                <div class="mb-4">
                    <div
                        class="d-flex justify-content-between align-items-center mb-2"
                    >
                        <span class="text-muted">Rejected</span>
                        <span class="fw-bold text-danger"
                            >{{ stats.loans_by_status.rejected }}</span
                        >
                    </div>
                    <div class="progress" style="height: 8px">
                        {% set percentage = (stats.loans_by_status.rejected /
                        stats.total_loans * 100) %}
                        <div
                            class="progress-bar bg-danger"
                            style="width: {{ percentage }}%"
                        ></div>
                    </div>
                </div>

                <div class="mb-4">
                    <div
                        class="d-flex justify-content-between align-items-center mb-2"
                    >
                        <span class="text-muted">Active</span>
                        <span class="fw-bold text-primary"
                            >{{ stats.loans_by_status.active }}</span
                        >
                    </div>
                    <div class="progress" style="height: 8px">
                        {% set percentage = (stats.loans_by_status.active /
                        stats.total_loans * 100) %}
                        <div
                            class="progress-bar bg-primary"
                            style="width: {{ percentage }}%"
                        ></div>
                    </div>
                </div>

                <div class="mb-0">
                    <div
                        class="d-flex justify-content-between align-items-center mb-2"
                    >
                        <span class="text-muted">Completed</span>
                        <span class="fw-bold text-secondary"
                            >{{ stats.loans_by_status.completed }}</span
                        >
                    </div>
                    <div class="progress" style="height: 8px">
                        {% set percentage = (stats.loans_by_status.completed /
                        stats.total_loans * 100) %}
                        <div
                            class="progress-bar bg-secondary"
                            style="width: {{ percentage }}%"
                        ></div>
                    </div>
                </div>
                {% else %}
                <div class="text-center py-5 text-muted">
                    <i class="bi bi-inbox fs-1 d-block mb-3"></i>
                    <p>No loan data available</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Loans by Sector -->
    <div class="col-lg-6">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom">
                <h5 class="mb-0 fw-bold">
                    <i class="bi bi-bar-chart me-2 text-success"></i>Loans by
                    Sector
                </h5>
            </div>
            <div class="card-body">
                {% if stats.loans_by_sector %} {% for sector, count, amount in
                stats.loans_by_sector %}
                <div class="mb-4">
                    <div
                        class="d-flex justify-content-between align-items-center mb-2"
                    >
                        <span class="text-muted">{{ sector }}</span>
                        <div>
                            <span class="badge bg-primary me-2"
                                >{{ count }} loans</span
                            >
                            <span class="fw-bold"
                                >${{ "%.0f"|format(amount) }}</span
                            >
                        </div>
                    </div>
                    <div class="progress" style="height: 8px">
                        {% set max_amount = stats.loans_by_sector[0][2] %} {%
                        set percentage = (amount / max_amount * 100) if
                        max_amount > 0 else 0 %}
                        <div
                            class="progress-bar bg-gradient"
                            style="width: {{ percentage }}%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);"
                        ></div>
                    </div>
                </div>
                {% endfor %} {% else %}
                <div class="text-center py-5 text-muted">
                    <i class="bi bi-inbox fs-1 d-block mb-3"></i>
                    <p>No sector data available</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Financial Metrics -->
<div class="row g-4 mt-2">
    <div class="col-lg-12">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom">
                <h5 class="mb-0 fw-bold">
                    <i class="bi bi-calculator me-2 text-info"></i>Financial
                    Overview
                </h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-3 mb-3 mb-md-0">
                        <div class="p-3">
                            <i
                                class="bi bi-cash-stack fs-2 text-success mb-2"
                            ></i>
                            <h4 class="mb-1">
                                ${{ "%.2f"|format(stats.avg_loan_amount) }}
                            </h4>
                            <p class="text-muted mb-0 small">
                                Average Loan Amount
                            </p>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3 mb-md-0">
                        <div class="p-3">
                            <i
                                class="bi bi-calendar-range fs-2 text-primary mb-2"
                            ></i>
                            <h4 class="mb-1">
                                {{ "%.1f"|format(stats.avg_payment_period) }}
                                months
                            </h4>
                            <p class="text-muted mb-0 small">Average Period</p>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3 mb-md-0">
                        <div class="p-3">
                            <i
                                class="bi bi-check-circle fs-2 text-info mb-2"
                            ></i>
                            <h4 class="mb-1">
                                ${{ "%.2f"|format(stats.approved_amount) }}
                            </h4>
                            <p class="text-muted mb-0 small">Approved Amount</p>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3 mb-md-0">
                        <div class="p-3">
                            <i class="bi bi-percent fs-2 text-warning mb-2"></i>
                            <h4 class="mb-1">{{ stats.approval_rate }}%</h4>
                            <p class="text-muted mb-0 small">Approval Rate</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Export Actions -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card border-0 shadow-sm">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="mb-1">Export Statistics</h6>
                        <p class="text-muted mb-0 small">
                            Download detailed reports for further analysis
                        </p>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-outline-primary" disabled>
                            <i class="bi bi-file-earmark-pdf me-1"></i>Export
                            PDF
                        </button>
                        <button class="btn btn-outline-success" disabled>
                            <i class="bi bi-file-earmark-excel me-1"></i>Export
                            Excel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}
